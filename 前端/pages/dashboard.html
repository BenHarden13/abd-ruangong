<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¥åº·ä»ªè¡¨ç›˜ - Diet Hub</title>
    <link rel="stylesheet" href="../css/main.css">
    <link rel="stylesheet" href="../css/dashboard.css">
    <link rel="stylesheet" href="../css/global-enhancements.css">
</head>
<body>
    <!-- å¯¼èˆªæ  -->
    <nav class="navbar">
        <div class="container">
            <div class="nav-brand">
                <h2>ğŸ Diet & Health Hub</h2>
            </div>
            <div class="nav-menu">
                <a href="../index.html" class="nav-link">é¦–é¡µ</a>
                <a href="profile.html" class="nav-link">å¥åº·æ¡£æ¡ˆ</a>
                <a href="dashboard.html" class="nav-link active">å¥åº·ä»ªè¡¨ç›˜</a>
                <a href="recommendations.html" class="nav-link">é¥®é£Ÿæ¨è</a>
            </div>
        </div>
    </nav>

    <!-- ä¸»è¦å†…å®¹ -->
    <main class="main-content">
        <div class="container">
            <div class="page-header">
                <h1>ğŸ“Š å¥åº·ä»ªè¡¨ç›˜</h1>
                <p>å…¨é¢äº†è§£æ‚¨çš„å¥åº·çŠ¶å†µ</p>
            </div>

            <!-- ç”¨æˆ·ä¿¡æ¯å¡ç‰‡ -->
            <div id="userInfoCard" class="user-info-card shadow-soft animate-fadeIn">
                <div class="user-info-header">
                    <h2>ğŸ‘¤ <span id="userName">ç”¨æˆ·</span></h2>
                    <button class="btn btn-sm btn-secondary" onclick="location.href='profile.html'">
                        ç¼–è¾‘æ¡£æ¡ˆ
                    </button>
                </div>
                <div class="user-info-grid">
                    <div class="info-item">
                        <span class="label">æ€§åˆ«:</span>
                        <span class="value" id="userGender">-</span>
                    </div>
                    <div class="info-item">
                        <span class="label">å¹´é¾„:</span>
                        <span class="value" id="userAge">-</span>
                    </div>
                    <div class="info-item">
                        <span class="label">èº«é«˜:</span>
                        <span class="value" id="userHeight">-</span>
                    </div>
                    <div class="info-item">
                        <span class="label">ä½“é‡:</span>
                        <span class="value" id="userWeight">-</span>
                    </div>
                    <div class="info-item">
                        <span class="label">æ´»åŠ¨æ°´å¹³:</span>
                        <span class="value" id="userActivity">-</span>
                    </div>
                    <div class="info-item">
                        <span class="label">å¥åº·ç›®æ ‡:</span>
                        <span class="value" id="userGoal">-</span>
                    </div>
                </div>
            </div>

            <!-- å¥åº·æŒ‡æ ‡å¡ç‰‡ç»„ -->
            <div class="metrics-grid">
                <!-- BMIå¡ç‰‡ -->
                <div class="metric-card bmi-card shadow-soft animate-fadeInUp delay-100">
                    <div class="metric-icon">ğŸ“</div>
                    <h3>BMI èº«ä½“è´¨é‡æŒ‡æ•°</h3>
                    <div class="metric-value" id="bmiValue">-</div>
                    <div class="metric-status" id="bmiStatus">-</div>
                    <div class="metric-description">
                        <small>ç†æƒ³èŒƒå›´: 18.5 - 24.9</small>
                    </div>
                </div>

                <!-- BMRå¡ç‰‡ -->
                <div class="metric-card bmr-card shadow-soft animate-fadeInUp delay-200">
                    <div class="metric-icon">ğŸ”¥</div>
                    <h3>BMR åŸºç¡€ä»£è°¢ç‡</h3>
                    <div class="metric-value" id="bmrValue">-</div>
                    <div class="metric-unit">åƒå¡/å¤©</div>
                    <div class="metric-description">
                        <small>é™æ¯çŠ¶æ€ä¸‹çš„èƒ½é‡æ¶ˆè€—</small>
                    </div>
                </div>

                <!-- TDEEå¡ç‰‡ -->
                <div class="metric-card tdee-card shadow-soft animate-fadeInUp delay-300">
                    <div class="metric-icon">âš¡</div>
                    <h3>TDEE æ€»èƒ½é‡æ¶ˆè€—</h3>
                    <div class="metric-value" id="tdeeValue">-</div>
                    <div class="metric-unit">åƒå¡/å¤©</div>
                    <div class="metric-description">
                        <small>åŒ…å«æ´»åŠ¨åœ¨å†…çš„æ€»æ¶ˆè€—</small>
                    </div>
                </div>

                <!-- ç›®æ ‡å¡è·¯é‡Œå¡ç‰‡ -->
                <div class="metric-card calories-card shadow-soft animate-fadeInUp delay-400">
                    <div class="metric-icon">ğŸ¯</div>
                    <h3>ç›®æ ‡å¡è·¯é‡Œ</h3>
                    <div class="metric-value" id="targetCalories">-</div>
                    <div class="metric-unit">åƒå¡/å¤©</div>
                    <div class="metric-description">
                        <small>åŸºäºæ‚¨çš„å¥åº·ç›®æ ‡</small>
                    </div>
                </div>
            </div>

            <!-- è¥å…»ç´ é…æ¯” -->
            <div class="nutrition-card shadow-soft animate-fadeInUp delay-500">
                <h2>ğŸ¥— æ¨èè¥å…»ç´ é…æ¯”</h2>
                <div class="macros-grid">
                    <div class="macro-item protein shadow-neumorphic">
                        <div class="macro-icon">ğŸ¥©</div>
                        <h3>è›‹ç™½è´¨</h3>
                        <div class="macro-amount" id="proteinAmount">-</div>
                        <div class="macro-percentage" id="proteinPercentage">-</div>
                        <div class="macro-calories" id="proteinCalories">-</div>
                    </div>
                    
                    <div class="macro-item carbs shadow-neumorphic">
                        <div class="macro-icon">ğŸš</div>
                        <h3>ç¢³æ°´åŒ–åˆç‰©</h3>
                        <div class="macro-amount" id="carbsAmount">-</div>
                        <div class="macro-percentage" id="carbsPercentage">-</div>
                        <div class="macro-calories" id="carbsCalories">-</div>
                    </div>
                    
                    <div class="macro-item fats shadow-neumorphic">
                        <div class="macro-icon">ğŸ¥‘</div>
                        <h3>è„‚è‚ª</h3>
                        <div class="macro-amount" id="fatsAmount">-</div>
                        <div class="macro-percentage" id="fatsPercentage">-</div>
                        <div class="macro-calories" id="fatsCalories">-</div>
                    </div>
                </div>

                <!-- ç¯å½¢å›¾è¡¨æ›¿ä»£è¿›åº¦æ¡ -->
                <div class="donut-chart-container">
                    <svg width="220" height="220" viewBox="0 0 220 220" class="donut-chart">
                        <circle r="90" cx="110" cy="110" fill="transparent" stroke="#e6e6e6" stroke-width="20"></circle>
                        <!-- è›‹ç™½è´¨å¼§ -->
                        <circle id="proteinArc" r="90" cx="110" cy="110" fill="transparent" stroke="#FF6B6B" stroke-width="20" stroke-dasharray="0 566" stroke-dashoffset="0" transform="rotate(-90 110 110)"></circle>
                        <!-- ç¢³æ°´å¼§ -->
                        <circle id="carbsArc" r="90" cx="110" cy="110" fill="transparent" stroke="#48DBFB" stroke-width="20" stroke-dasharray="0 566" stroke-dashoffset="0" transform="rotate(-90 110 110)"></circle>
                        <!-- è„‚è‚ªå¼§ -->
                        <circle id="fatsArc" r="90" cx="110" cy="110" fill="transparent" stroke="#1DD1A1" stroke-width="20" stroke-dasharray="0 566" stroke-dashoffset="0" transform="rotate(-90 110 110)"></circle>
                    </svg>
                    <div class="donut-center">
                        <span id="totalCalories">-</span>
                        <small>å¡è·¯é‡Œ</small>
                    </div>
                </div>
            </div>

            <!-- BMIå›¾è¡¨è¯´æ˜ -->
            <div class="bmi-chart-card shadow-soft animate-fadeInUp">
                <h2>ğŸ“ˆ BMI åˆ†ç±»æ ‡å‡†</h2>
                <div class="bmi-ranges interactive-ranges">
                    <div class="bmi-range underweight shadow-neumorphic" data-bmi-range="underweight">
                        <span class="range-label">åç˜¦</span>
                        <span class="range-value">&lt; 18.5</span>
                    </div>
                    <div class="bmi-range normal shadow-neumorphic" data-bmi-range="normal">
                        <span class="range-label">æ­£å¸¸</span>
                        <span class="range-value">18.5 - 24.9</span>
                    </div>
                    <div class="bmi-range overweight shadow-neumorphic" data-bmi-range="overweight">
                        <span class="range-label">è¶…é‡</span>
                        <span class="range-value">25.0 - 29.9</span>
                    </div>
                    <div class="bmi-range obese shadow-neumorphic" data-bmi-range="obese">
                        <span class="range-label">è‚¥èƒ–</span>
                        <span class="range-value">â‰¥ 30.0</span>
                    </div>
                </div>
            </div>

            <!-- å¥åº·å»ºè®® -->
            <div class="recommendations-card shadow-soft animate-fadeInUp">
                <h2>ğŸ’¡ ä¸ªæ€§åŒ–å»ºè®®</h2>
                <div id="healthAdvice" class="advice-list">
                    <p class="no-data">è¯·å…ˆå®Œå–„æ‚¨çš„å¥åº·æ¡£æ¡ˆ</p>
                </div>
                <div class="card-actions">
                    <button class="btn btn-primary" onclick="location.href='recommendations.html'">
                        æŸ¥çœ‹é¥®é£Ÿæ¨è
                    </button>
                </div>
            </div>

            <!-- æ²¡æœ‰æ•°æ®æ—¶çš„æç¤º -->
            <div id="noDataMessage" class="no-data-card shadow-neumorphic animate-scaleIn">
                <div class="no-data-icon animate-pulse">ğŸ“‹</div>
                <h2>è¿˜æ²¡æœ‰å¥åº·æ¡£æ¡ˆ</h2>
                <p>è¯·å…ˆåˆ›å»ºæ‚¨çš„ä¸ªäººå¥åº·æ¡£æ¡ˆï¼Œä»¥æŸ¥çœ‹è¯¦ç»†çš„å¥åº·åˆ†æ</p>
                <button class="btn btn-primary btn-lg" onclick="location.href='profile.html'">
                    åˆ›å»ºæ¡£æ¡ˆ
                </button>
            </div>
        </div>
    </main>

    <!-- é¡µè„š -->
    <footer class="footer">
        <div class="container">
            <p>&copy; 2024 Diet & Health Hub. å¥åº·ç”Ÿæ´»ï¼Œä»ç§‘å­¦é¥®é£Ÿå¼€å§‹ã€‚</p>
        </div>
    </footer>

    <script src="../js/api.js"></script>
    <script src="../js/CountUpEffect.js" type="module"></script>
    <script src="../js/dashboard.js"></script>
    
    <script>
        // å¢å¼ºä»ªè¡¨ç›˜äº¤äº’æ•ˆæœ
        document.addEventListener('DOMContentLoaded', function() {
            // åˆå§‹åŒ–BMIåˆ†ç±»æ ‡ç­¾äº¤äº’
            initBmiRangeInteraction();
            
            // åˆå§‹åŒ–ç¯å½¢å›¾è¡¨åŠ¨ç”»
            initDonutChartAnimation();
        });
        
        // BMIåˆ†ç±»æ ‡ç­¾äº¤äº’æ•ˆæœ
        function initBmiRangeInteraction() {
            const bmiRanges = document.querySelectorAll('.bmi-range');
            const bmiCard = document.querySelector('.bmi-card');
            
            bmiRanges.forEach(range => {
                range.addEventListener('mouseenter', function() {
                    // æ·»åŠ é«˜äº®æ•ˆæœ
                    this.classList.add('active');
                    
                    // è·å–BMIèŒƒå›´ç±»å‹
                    const rangeType = this.getAttribute('data-bmi-range');
                    
                    // æ£€æŸ¥å½“å‰ç”¨æˆ·çš„BMIå€¼æ‰€åœ¨èŒƒå›´
                    const currentBmi = parseFloat(document.getElementById('bmiValue').textContent);
                    const isUserInThisRange = checkIfBmiInRange(currentBmi, rangeType);
                    
                    // å¦‚æœç”¨æˆ·åœ¨æ­¤èŒƒå›´å†…ï¼Œå¢å¼ºBMIå¡ç‰‡æ•ˆæœ
                    if (isUserInThisRange) {
                        bmiCard.classList.add('highlighted');
                    }
                });
                
                range.addEventListener('mouseleave', function() {
                    // ç§»é™¤é«˜äº®æ•ˆæœ
                    this.classList.remove('active');
                    bmiCard.classList.remove('highlighted');
                });
            });
        }
        
        // æ£€æŸ¥BMIå€¼æ˜¯å¦åœ¨æŒ‡å®šèŒƒå›´å†…
        function checkIfBmiInRange(bmi, rangeType) {
            switch(rangeType) {
                case 'underweight':
                    return bmi < 18.5;
                case 'normal':
                    return bmi >= 18.5 && bmi < 25;
                case 'overweight':
                    return bmi >= 25 && bmi < 30;
                case 'obese':
                    return bmi >= 30;
                default:
                    return false;
            }
        }
        
        // åˆå§‹åŒ–ç¯å½¢å›¾è¡¨åŠ¨ç”»
        function initDonutChartAnimation() {
            // è·å–SVGåœ†å½¢å…ƒç´ 
            const proteinArc = document.getElementById('proteinArc');
            const carbsArc = document.getElementById('carbsArc');
            const fatsArc = document.getElementById('fatsArc');
            
            // åœ†å‘¨é•¿
            const circumference = 2 * Math.PI * 90;
            
            // ç¤ºä¾‹æ•°æ® (æœ€ç»ˆä¼šä»APIè·å–)
            const nutritionData = {
                protein: { percent: 30 },
                carbs: { percent: 40 },
                fats: { percent: 30 }
            };
            
            // è®¡ç®—å„éƒ¨åˆ†çš„å¼§é•¿å’Œåç§»é‡
            let offset = 0;
            
            // è›‹ç™½è´¨å¼§
            const proteinLength = (nutritionData.protein.percent / 100) * circumference;
            proteinArc.style.strokeDasharray = `${proteinLength} ${circumference}`;
            proteinArc.style.strokeDashoffset = '0';
            offset += proteinLength;
            
            // ç¢³æ°´å¼§
            const carbsLength = (nutritionData.carbs.percent / 100) * circumference;
            carbsArc.style.strokeDasharray = `${carbsLength} ${circumference}`;
            carbsArc.style.strokeDashoffset = `-${offset}`;
            offset += carbsLength;
            
            // è„‚è‚ªå¼§
            const fatsLength = (nutritionData.fats.percent / 100) * circumference;
            fatsArc.style.strokeDasharray = `${fatsLength} ${circumference}`;
            fatsArc.style.strokeDashoffset = `-${offset}`;
            
            // åº”ç”¨åŠ¨ç”»
            [proteinArc, carbsArc, fatsArc].forEach(arc => {
                const originalDashArray = arc.style.strokeDasharray;
                arc.style.strokeDasharray = '0 ' + circumference;
                
                setTimeout(() => {
                    arc.style.transition = 'stroke-dasharray 1.5s ease';
                    arc.style.strokeDasharray = originalDashArray;
                }, 500);
            });
        }
    </script>
</body>
</html>
